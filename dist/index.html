<!doctype html>
<html lang="vi">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Quiz Hán tự - Pinyin</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="quiz">
        <h1>Quiz Hán tự → Pinyin
            Tác giả: Bùi Giang Nam
        </h1>
        <div class="row">
            <input id="sheetUrl" type="url" placeholder="Dán link CSV hoặc chọn bộ từ bên dưới" />
            <button id="loadBtn">Tải từ link</button>
            <button id="nextBtn" class="hidden">Câu tiếp ▶</button>
        </div>

        <div class="dataset-section">
            <h3>Chọn bộ từ:</h3>
            <div class="dataset-buttons">
                <button class="dataset-btn" data-file="data/HSK1.csv">HSK 1 (150 từ)</button>
                <button class="dataset-btn" data-file="data/HSK2.csv">HSK 2 (151 từ)</button>
                <button class="dataset-btn" data-file="data/HSK3.csv">HSK 3 (296 từ)</button>
                <button class="dataset-btn" data-file="data/all1-3.csv">Tất cả HSK 1-3 (596 từ)</button>
                <button class="dataset-btn speaking-btn" data-file="data/onhsk3.txt">HSK 3 Nói (76 câu)</button>
            </div>
        </div>
        <div class="muted">Mẹo: 1–4 để chọn đáp án; Enter/Space để sang câu tiếp. Trả lời sai được chọn lại.</div>

        <div id="status" class="muted" style="margin-top:8px;">Chưa tải dữ liệu.</div>

        <!-- Quiz Mode -->
        <div id="card" class="hidden">
            <div id="hanzi" class="hanzi">字</div>
            <div id="options" class="options"></div>
            <div class="bar">
                <div id="progress" class="muted">Câu: 0</div>
                <div id="score" class="score">Đúng: 0</div>
            </div>
            <div id="example" class="muted hidden" style="margin-top:12px; line-height:1.6;">
                <div><strong>Nghĩa (VI):</strong> <span id="exMeaning"></span></div>
                <div><strong>Ví dụ (chữ Hán):</strong> <span id="exHanzi"></span></div>
                <div><strong>Phiên âm:</strong> <span id="exPinyin"></span></div>
                <div><strong>Dịch:</strong> <span id="exVi"></span></div>
            </div>
        </div>

        <!-- Speaking Mode -->
        <div id="speaking-card" class="hidden">
            <div class="speaking-content">
                <div id="speaking-hanzi" class="speaking-hanzi">你现在在哪个城市生活？</div>
                <div id="speaking-pinyin" class="speaking-pinyin">Nǐ xiànzài zài nǎge chéngshì shēnghuó?</div>
                <div class="speaking-controls">
                    <button id="speak-btn" class="speak-btn">🔊 Đọc</button>
                    <button id="speaking-next-btn" class="speaking-next-btn">Câu tiếp ▶</button>
                    <button id="random-toggle-btn" class="random-toggle-btn">🎲 Random</button>
                </div>
            </div>
            <div class="speaking-bar">
                <div id="speaking-progress" class="muted">Câu: 0</div>
                <div class="speaking-mode-indicator">📢 Chế độ nói</div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        // Debug script
        setTimeout(() => {
            console.log('=== DEBUG SCRIPT ===');
            console.log('Environment:', {
                hostname: window.location.hostname,
                protocol: window.location.protocol,
                pathname: window.location.pathname
            });

            const randomBtn = document.getElementById('random-toggle-btn');
            console.log('Random button found:', !!randomBtn);
            if (randomBtn) {
                console.log('Button text:', randomBtn.textContent);
                console.log('Button styles:', {
                    background: window.getComputedStyle(randomBtn).background,
                    cursor: window.getComputedStyle(randomBtn).cursor,
                    pointerEvents: window.getComputedStyle(randomBtn).pointerEvents,
                    zIndex: window.getComputedStyle(randomBtn).zIndex
                });

                // Test click manually
                randomBtn.onclick = function (e) {
                    console.log('Manual click handler triggered!');
                    e.preventDefault();
                    e.stopPropagation();

                    // Toggle random mode
                    const isActive = randomBtn.classList.contains('active');
                    randomBtn.classList.toggle('active', !isActive);
                    randomBtn.textContent = !isActive ? '🎲 Random ON' : '🎲 Random';

                    // Set global variable for script.js
                    window.isRandomMode = !isActive;

                    console.log('Random mode:', !isActive ? 'ON' : 'OFF');
                    console.log('Global isRandomMode:', window.isRandomMode);
                    return false;
                };

                console.log('Manual click handler added');
            }

            // Check if script.js loaded properly
            console.log('Script.js functions available:', {
                loadDataset: typeof window.loadDataset,
                nextSpeakingQuestion: typeof window.nextSpeakingQuestion,
                toggleRandomMode: typeof window.toggleRandomMode
            });

            // Test random functionality directly
            window.testRandom = function () {
                console.log('=== TEST RANDOM FUNCTION ===');
                console.log('Current speaking data length:', window.speakingData ? window.speakingData.length : 'undefined');
                console.log('Current speaking index:', window.speakingIndex);
                console.log('Is random mode:', window.isRandomMode);

                if (window.speakingData && window.speakingData.length > 0) {
                    const randomIndex = Math.floor(Math.random() * window.speakingData.length);
                    console.log('Random index would be:', randomIndex);
                    console.log('Random question would be:', window.speakingData[randomIndex]);
                }
            };

            // Test speaking next button directly
            window.testSpeakingNext = function () {
                console.log('=== TEST SPEAKING NEXT ===');
                const speakingNextBtn = document.getElementById('speaking-next-btn');
                console.log('Speaking next button found:', !!speakingNextBtn);
                if (speakingNextBtn) {
                    console.log('Clicking speaking next button...');
                    speakingNextBtn.click();
                }
            };

            console.log('Test functions added: window.testRandom() and window.testSpeakingNext()');
        }, 1000);
    </script>
</body>

</html>
<!doctype html>
<html lang="vi">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Quiz HÃ¡n tá»± - Pinyin</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="quiz">
        <h1>Quiz HÃ¡n tá»± â†’ Pinyin
            TÃ¡c giáº£: BÃ¹i Giang Nam
        </h1>
        <div class="row">
            <input id="sheetUrl" type="url" placeholder="DÃ¡n link CSV hoáº·c chá»n bá»™ tá»« bÃªn dÆ°á»›i" />
            <button id="loadBtn">Táº£i tá»« link</button>
            <button id="nextBtn" class="hidden">CÃ¢u tiáº¿p â–¶</button>
        </div>

        <div class="dataset-section">
            <h3>Chá»n bá»™ tá»«:</h3>
            <div class="dataset-buttons">
                <button class="dataset-btn" data-file="data/HSK1.csv">HSK 1 (150 tá»«)</button>
                <button class="dataset-btn" data-file="data/HSK2.csv">HSK 2 (151 tá»«)</button>
                <button class="dataset-btn" data-file="data/HSK3.csv">HSK 3 (296 tá»«)</button>
                <button class="dataset-btn" data-file="data/all1-3.csv">Táº¥t cáº£ HSK 1-3 (596 tá»«)</button>
                <button class="dataset-btn speaking-btn" data-file="data/onhsk3.txt">HSK 3 NÃ³i (76 cÃ¢u)</button>
            </div>
        </div>
        <div class="muted">Máº¹o: 1â€“4 Ä‘á»ƒ chá»n Ä‘Ã¡p Ã¡n; Enter/Space Ä‘á»ƒ sang cÃ¢u tiáº¿p. Tráº£ lá»i sai Ä‘Æ°á»£c chá»n láº¡i.</div>

        <div id="status" class="muted" style="margin-top:8px;">ChÆ°a táº£i dá»¯ liá»‡u.</div>

        <!-- Quiz Mode -->
        <div id="card" class="hidden">
            <div id="hanzi" class="hanzi">å­—</div>
            <div id="options" class="options"></div>
            <div class="bar">
                <div id="progress" class="muted">CÃ¢u: 0</div>
                <div id="score" class="score">ÄÃºng: 0</div>
            </div>
            <div id="example" class="muted hidden" style="margin-top:12px; line-height:1.6;">
                <div><strong>NghÄ©a (VI):</strong> <span id="exMeaning"></span></div>
                <div><strong>VÃ­ dá»¥ (chá»¯ HÃ¡n):</strong> <span id="exHanzi"></span></div>
                <div><strong>PhiÃªn Ã¢m:</strong> <span id="exPinyin"></span></div>
                <div><strong>Dá»‹ch:</strong> <span id="exVi"></span></div>
            </div>
        </div>

        <!-- Speaking Mode -->
        <div id="speaking-card" class="hidden">
            <div class="speaking-content">
                <div id="speaking-hanzi" class="speaking-hanzi">ä½ ç°åœ¨åœ¨å“ªä¸ªåŸå¸‚ç”Ÿæ´»ï¼Ÿ</div>
                <div id="speaking-pinyin" class="speaking-pinyin">NÇ xiÃ nzÃ i zÃ i nÇge chÃ©ngshÃ¬ shÄ“nghuÃ³?</div>
                <div class="speaking-controls">
                    <button id="speak-btn" class="speak-btn">ğŸ”Š Äá»c</button>
                    <button id="speaking-next-btn" class="speaking-next-btn">CÃ¢u tiáº¿p â–¶</button>
                    <button id="random-toggle-btn" class="random-toggle-btn">ğŸ² Random</button>
                </div>
            </div>
            <div class="speaking-bar">
                <div id="speaking-progress" class="muted">CÃ¢u: 0</div>
                <div class="speaking-mode-indicator">ğŸ“¢ Cháº¿ Ä‘á»™ nÃ³i</div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        // Debug script
        setTimeout(() => {
            console.log('=== DEBUG SCRIPT ===');
            console.log('Environment:', {
                hostname: window.location.hostname,
                protocol: window.location.protocol,
                pathname: window.location.pathname
            });

            const randomBtn = document.getElementById('random-toggle-btn');
            console.log('Random button found:', !!randomBtn);
            if (randomBtn) {
                console.log('Button text:', randomBtn.textContent);
                console.log('Button styles:', {
                    background: window.getComputedStyle(randomBtn).background,
                    cursor: window.getComputedStyle(randomBtn).cursor,
                    pointerEvents: window.getComputedStyle(randomBtn).pointerEvents,
                    zIndex: window.getComputedStyle(randomBtn).zIndex
                });

                // Test click manually
                randomBtn.onclick = function (e) {
                    console.log('Manual click handler triggered!');
                    e.preventDefault();
                    e.stopPropagation();

                    // Toggle random mode
                    const isActive = randomBtn.classList.contains('active');
                    randomBtn.classList.toggle('active', !isActive);
                    randomBtn.textContent = !isActive ? 'ğŸ² Random ON' : 'ğŸ² Random';

                    // Set global variable for script.js
                    window.isRandomMode = !isActive;

                    console.log('Random mode:', !isActive ? 'ON' : 'OFF');
                    console.log('Global isRandomMode:', window.isRandomMode);
                    return false;
                };

                console.log('Manual click handler added');
            }

            // Check if script.js loaded properly
            console.log('Script.js functions available:', {
                loadDataset: typeof window.loadDataset,
                nextSpeakingQuestion: typeof window.nextSpeakingQuestion,
                toggleRandomMode: typeof window.toggleRandomMode
            });

            // Test random functionality directly
            window.testRandom = function () {
                console.log('=== TEST RANDOM FUNCTION ===');
                console.log('Current speaking data length:', window.speakingData ? window.speakingData.length : 'undefined');
                console.log('Current speaking index:', window.speakingIndex);
                console.log('Is random mode:', window.isRandomMode);

                if (window.speakingData && window.speakingData.length > 0) {
                    const randomIndex = Math.floor(Math.random() * window.speakingData.length);
                    console.log('Random index would be:', randomIndex);
                    console.log('Random question would be:', window.speakingData[randomIndex]);
                }
            };

            // Test speaking next button directly
            window.testSpeakingNext = function () {
                console.log('=== TEST SPEAKING NEXT ===');
                const speakingNextBtn = document.getElementById('speaking-next-btn');
                console.log('Speaking next button found:', !!speakingNextBtn);
                if (speakingNextBtn) {
                    console.log('Clicking speaking next button...');
                    speakingNextBtn.click();
                }
            };

            console.log('Test functions added: window.testRandom() and window.testSpeakingNext()');
        }, 1000);
    </script>
</body>

</html>